---
phase: 03-proxy-integration
plan: 02
type: execute
---

<objective>
Update documentation and verify proxy integration works end-to-end.

Purpose: Ensure proxy setup is documented and users can successfully intercept traffic.
Output: Updated README with proxy section, verification of complete workflow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-proxy-integration/03-01-SUMMARY.md

# Key files to modify:
@README.md
@configure-proxy.sh
@install-burp-cert.sh
@start-emulator-proxy.sh

**Tech stack available:** bash, adb, Burp Suite CE
**Established patterns:**
- README has Overview, Quick Start, Scripts Overview sections
- Environment variables documented in Configuration section
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README with Proxy Integration section</name>
  <files>README.md</files>
  <action>
Add a new "Proxy Integration" section to README.md after the "Configuration" section:

```markdown
## Proxy Integration

Route emulator traffic through Burp Suite CE for security testing.

### Prerequisites

1. **Burp Suite CE** running on localhost:8080
2. **Burp CA certificate** exported (see below)

### Quick Start

```bash
# 1. Export Burp CA certificate (one-time setup)
#    Burp > Proxy > Options > Import/Export CA > Export as DER
#    Save as: ~/burp-ca.der

# 2. Install certificate on emulator
./install-burp-cert.sh

# 3. Start emulator with proxy
./start-emulator-proxy.sh
```

### Manual Proxy Control

```bash
# Enable proxy (default: Burp on host)
./configure-proxy.sh

# Enable proxy with custom address
./configure-proxy.sh 10.0.2.2:8081

# Disable proxy
./configure-proxy.sh --disable

# Check current proxy setting
adb shell settings get global http_proxy
```

### Troubleshooting Proxy

**No traffic in Burp:**
- Verify Burp is listening: Proxy > Options > Proxy Listeners
- Check proxy is set: `adb shell settings get global http_proxy`
- Ensure emulator can reach host: `adb shell ping -c 1 10.0.2.2`

**HTTPS traffic not visible:**
- Install Burp CA certificate: `./install-burp-cert.sh`
- Some apps use certificate pinning (see Security Bypasses section)

**Connection refused:**
- Burp may not be running
- Check Burp's proxy listener is bound to all interfaces or localhost
```

Also update the Scripts Overview table to include the new scripts:
| `configure-proxy.sh` | Configure emulator proxy settings |
| `install-burp-cert.sh` | Install Burp CA certificate on emulator |
| `start-emulator-proxy.sh` | Start emulator with proxy pre-configured |
  </action>
  <verify>
grep -q "Proxy Integration" README.md && echo "Has Proxy Integration section - good"
grep -q "configure-proxy.sh" README.md && echo "Documents configure-proxy.sh - good"
grep -q "install-burp-cert.sh" README.md && echo "Documents install-burp-cert.sh - good"
  </verify>
  <done>
- README has Proxy Integration section
- Quick start instructions for proxy setup
- Manual proxy control commands documented
- Troubleshooting tips included
- Scripts Overview table updated
  </done>
</task>

<task type="auto">
  <name>Task 2: Add environment variable support to proxy scripts</name>
  <files>configure-proxy.sh</files>
  <action>
Update configure-proxy.sh to support BURP_PROXY environment variable for consistency with other scripts:

1. Add support for BURP_PROXY env var as alternative to argument
2. Priority: CLI arg > env var > default
3. Update usage message to show env var option

Update the script header:
```bash
#!/bin/bash
# Configure Android emulator proxy settings
#
# Usage: ./configure-proxy.sh [host:port]
#        ./configure-proxy.sh --disable
#    or: BURP_PROXY=10.0.2.2:8080 ./configure-proxy.sh
#
# Default proxy: 10.0.2.2:8080 (Burp on host machine)

# Get proxy from arg, env var, or default
if [ "$1" = "--disable" ] || [ "$1" = "--off" ]; then
    # Handle disable separately
    ...
elif [ -n "$1" ]; then
    PROXY="$1"
elif [ -n "$BURP_PROXY" ]; then
    PROXY="$BURP_PROXY"
else
    PROXY="10.0.2.2:8080"
fi
```

Update .env.example to include BURP_PROXY:
```
# Optional - Burp proxy address (for emulator traffic interception)
# BURP_PROXY=10.0.2.2:8080
```
  </action>
  <verify>
grep -q "BURP_PROXY" configure-proxy.sh && echo "Supports BURP_PROXY env var - good"
grep -q "BURP_PROXY" .env.example && echo "BURP_PROXY in .env.example - good"
  </verify>
  <done>
- configure-proxy.sh supports BURP_PROXY environment variable
- .env.example updated with BURP_PROXY
- Consistent with other scripts' env var patterns
  </done>
</task>

<task type="auto">
  <name>Task 3: Add proxy status to connect-device.sh</name>
  <files>connect-device.sh</files>
  <action>
Update connect-device.sh to show current proxy status when checking device info.

Add after the Bluetooth status section:
```bash
# Check proxy status
echo ""
echo "Proxy Status:"
PROXY_SETTING=$(adb -s "$DEVICE_ID" shell settings get global http_proxy 2>/dev/null)
if [ -n "$PROXY_SETTING" ] && [ "$PROXY_SETTING" != ":0" ] && [ "$PROXY_SETTING" != "null" ]; then
    echo "  Proxy: ENABLED ($PROXY_SETTING)"
else
    echo "  Proxy: DISABLED"
    echo "  To enable: ./configure-proxy.sh"
fi
```

This provides visibility into proxy state when connecting to a device.
  </action>
  <verify>
grep -q "Proxy Status" connect-device.sh && echo "Shows proxy status - good"
grep -q "http_proxy" connect-device.sh && echo "Checks http_proxy setting - good"
  </verify>
  <done>
- connect-device.sh shows current proxy status
- Indicates if proxy is enabled or disabled
- Provides hint to enable proxy if disabled
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] README.md has Proxy Integration section with quick start
- [ ] configure-proxy.sh supports BURP_PROXY env var
- [ ] .env.example includes BURP_PROXY
- [ ] connect-device.sh shows proxy status
- [ ] All documentation is accurate and helpful
</verification>

<success_criteria>

- Proxy workflow fully documented in README
- Environment variable support for proxy configuration
- Proxy status visible in device connection script
- Phase 3: Proxy Integration complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-proxy-integration/03-02-SUMMARY.md`

Mark Phase 3 as complete in ROADMAP.md and STATE.md.
</output>
