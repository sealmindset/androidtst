---
phase: 04-apk-analysis-tooling
plan: 01
type: execute
---

<objective>
Create jadx integration script for decompiling APKs to Java source code.

Purpose: Enable examination of decompiled Java source code from APKs for security analysis.
Output: Script that decompiles APKs using jadx with organized output structure.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-proxy-integration/03-02-SUMMARY.md

# Key files:
@extract-apk.sh
@.env.example

**Tech stack available:** bash, adb, Python 3
**Established patterns:**
- Shell scripts accept args OR env vars (TARGET_PACKAGE pattern)
- Scripts check prerequisites before proceeding
- Output organized in dedicated directories (apks/)
- Helpful usage messages when args missing

**Constraining decisions:**
- [02-02]: Shell scripts accept package as argument OR from TARGET_PACKAGE env var
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create decompile-apk.sh script for jadx integration</name>
  <files>decompile-apk.sh</files>
  <action>
Create a new script `decompile-apk.sh` that:
1. Accepts APK path as argument OR uses most recent APK from apks/ directory
2. Checks if jadx is installed (`command -v jadx`), shows install instructions if not
3. Creates `decompiled/` directory for output
4. Runs jadx with appropriate options:
   - `jadx <apk> -d decompiled/<app-name>/jadx/`
   - Use `--show-bad-code` to include problematic decompilation attempts
   - Use `--deobf` for basic deobfuscation
5. Shows summary of decompiled files (source files count, key directories)
6. Provides hints for examining the code

Structure:
```bash
#!/bin/bash
# Decompile APK to Java source using jadx
#
# Usage: ./decompile-apk.sh [path/to/app.apk]
#        (defaults to most recent APK in apks/ directory)
#
# Prerequisites:
#   - jadx installed: brew install jadx

set -e

# Check for jadx
if ! command -v jadx &> /dev/null; then
    echo "ERROR: jadx is not installed."
    echo ""
    echo "Install with Homebrew:"
    echo "  brew install jadx"
    exit 1
fi

# Get APK path
if [ -n "$1" ]; then
    APK_PATH="$1"
else
    # Find most recent APK in apks/ directory
    APK_PATH=$(ls -t apks/*.apk 2>/dev/null | head -1)
    if [ -z "$APK_PATH" ]; then
        echo "ERROR: No APK specified and none found in apks/"
        echo ""
        echo "Usage: ./decompile-apk.sh [path/to/app.apk]"
        echo ""
        echo "Extract an APK first: ./extract-apk.sh <package-name>"
        exit 1
    fi
fi

# Validate APK exists
if [ ! -f "$APK_PATH" ]; then
    echo "ERROR: APK not found: $APK_PATH"
    exit 1
fi

# Create output directory based on APK name
APK_NAME=$(basename "$APK_PATH" .apk)
OUTPUT_DIR="decompiled/${APK_NAME}/jadx"

echo "=== APK Decompiler (jadx) ==="
echo ""
echo "Input:  $APK_PATH"
echo "Output: $OUTPUT_DIR"
echo ""

mkdir -p "$OUTPUT_DIR"

# Run jadx
echo "Decompiling (this may take a minute)..."
jadx "$APK_PATH" -d "$OUTPUT_DIR" --show-bad-code --deobf

echo ""
echo "=== Decompilation Complete ==="
echo ""
echo "Source files:"
find "$OUTPUT_DIR/sources" -name "*.java" 2>/dev/null | wc -l | xargs echo "  Java files:"
echo ""
echo "Key directories:"
echo "  $OUTPUT_DIR/sources/      - Decompiled Java source"
echo "  $OUTPUT_DIR/resources/    - Extracted resources"
echo ""
echo "To browse source code:"
echo "  code $OUTPUT_DIR/sources   # Open in VS Code"
echo "  # or"
echo "  ls $OUTPUT_DIR/sources     # List packages"
```
  </action>
  <verify>
chmod +x decompile-apk.sh
./decompile-apk.sh --help 2>&1 | head -5 || ./decompile-apk.sh 2>&1 | head -10
# Should show usage or error about missing APK
  </verify>
  <done>
- decompile-apk.sh created and executable
- Checks for jadx installation
- Accepts APK path or finds most recent in apks/
- Outputs to decompiled/<app>/jadx/
- Shows helpful summary after decompilation
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README with APK decompilation section</name>
  <files>README.md</files>
  <action>
Add a new "APK Analysis" section to README.md after the "Proxy Integration" section:

```markdown
## APK Analysis

Decompile APKs to examine source code and resources.

### Prerequisites

Install decompilation tools:
```bash
brew install jadx    # Java source decompilation
brew install apktool # Resource extraction (optional)
```

### Decompiling APKs

```bash
# 1. Extract APK from device
./extract-apk.sh com.example.app

# 2. Decompile to Java source
./decompile-apk.sh apks/app_v1.2.3.apk
# or auto-select most recent APK:
./decompile-apk.sh

# Output structure:
# decompiled/<app>/jadx/sources/  - Java source code
# decompiled/<app>/jadx/resources/ - App resources
```

### Examining Code

```bash
# Open in VS Code
code decompiled/<app>/jadx/sources

# Search for interesting patterns
grep -r "api.example.com" decompiled/<app>/jadx/sources/
grep -r "password" decompiled/<app>/jadx/sources/
grep -r "secret" decompiled/<app>/jadx/sources/

# Find network-related code
grep -rl "HttpURLConnection\|OkHttp\|Retrofit" decompiled/<app>/jadx/sources/
```
```

Also update the Scripts Overview table to include decompile-apk.sh.
  </action>
  <verify>
grep -q "APK Analysis" README.md && echo "Has APK Analysis section - good"
grep -q "decompile-apk.sh" README.md && echo "Documents decompile-apk.sh - good"
  </verify>
  <done>
- README has APK Analysis section
- Decompilation workflow documented
- Code examination examples provided
- Scripts table updated
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] decompile-apk.sh exists and is executable
- [ ] Script checks for jadx installation
- [ ] README documents APK analysis workflow
- [ ] Output directory structure is decompiled/<app>/jadx/
</verification>

<success_criteria>

- jadx integration script created and functional
- Documentation updated with APK analysis workflow
- User can decompile APKs with single command
</success_criteria>

<output>
After completion, create `.planning/phases/04-apk-analysis-tooling/04-01-SUMMARY.md`
</output>
