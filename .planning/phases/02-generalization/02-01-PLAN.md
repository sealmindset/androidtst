---
phase: 02-generalization
plan: 01
type: execute
---

<objective>
Generalize Python components to be app-agnostic.

Purpose: Remove SleepIQ-specific code from Python harness and config, making the test harness work with any Android app.
Output: Renamed AndroidTestHarness class, flexible config module, template-based IDOR test.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-configuration-security/01-01-SUMMARY.md
@.planning/phases/01-configuration-security/01-02-SUMMARY.md

# Key files to modify:
@test_harness.py
@config.py
@test_idor.py
@.env.example

**Tech stack available:** python-dotenv
**Established patterns:**
- Config via environment: `from config import config`
- Error on missing required env vars
- Secure temp: `get_secure_temp_file(suffix) -> path`

**Constraining decisions:**
- [01-01]: Use python-dotenv for .env loading
- [01-01]: Use dataclass for typed configuration
- [01-01]: No default values for credentials - must be explicit
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename SleepIQTestHarness to AndroidTestHarness with configurable package</name>
  <files>test_harness.py</files>
  <action>
1. Rename class `SleepIQTestHarness` → `AndroidTestHarness`
2. Replace hardcoded `PACKAGE_NAME = "com.selectcomfort.SleepIQ"` with constructor parameter `package_name: str`
3. Update all docstrings and comments to reference "Android Test Harness" not "SleepIQ"
4. Update module docstring to show generic usage:
   ```python
   from test_harness import AndroidTestHarness
   harness = AndroidTestHarness("com.example.myapp")
   harness.launch_app()
   ```
5. Update `main()` to read package name from environment variable `TARGET_PACKAGE` (with fallback to prompt)
6. Keep backward compatibility: if TARGET_PACKAGE not set, prompt user for package name
7. Update error messages to be generic (e.g., "App not installed" not "SleepIQ app not installed")
  </action>
  <verify>
python3 -c "from test_harness import AndroidTestHarness; h = AndroidTestHarness('com.test.app'); print(h.package_name)"
# Should print: com.test.app
  </verify>
  <done>
- Class renamed to AndroidTestHarness
- package_name is constructor parameter
- No "SleepIQ" references remain in test_harness.py
- Import statement `from test_harness import AndroidTestHarness` works
  </done>
</task>

<task type="auto">
  <name>Task 2: Generalize config.py to be app-agnostic</name>
  <files>config.py, .env.example</files>
  <action>
1. In config.py:
   - Rename `sleeper_id` field to `target_id` (generic identifier for testing)
   - Rename env var `SLEEPER_ID` → `TARGET_ID`
   - Remove hardcoded SleepIQ API_BASE default, make it required OR use empty default
   - Update docstring to remove SleepIQ references
   - Make credentials optional (for harnesses that don't need auth):
     - TEST_EMAIL, TEST_PASSWORD, TARGET_ID: optional, return None if not set
     - API_BASE: optional with no default
   - Add TARGET_PACKAGE env var to config (required for scripts that need it)

2. In .env.example:
   - Rename SLEEPER_ID → TARGET_ID
   - Remove SleepIQ-specific comments
   - Add TARGET_PACKAGE example
   - Add comments explaining each variable's purpose

3. Error handling:
   - Don't raise ConfigurationError on import if optional vars missing
   - Provide `config.require_auth()` method that checks auth vars and raises if missing
  </action>
  <verify>
# Should succeed with just TARGET_PACKAGE
TARGET_PACKAGE=com.test.app python3 -c "from config import config; print(config.target_package)"

# Should have None for optional fields
TARGET_PACKAGE=com.test.app python3 -c "from config import config; print(config.test_email)"
# Should print: None
  </verify>
  <done>
- Config no longer requires credentials on import
- SLEEPER_ID renamed to TARGET_ID
- TARGET_PACKAGE added
- No "SleepIQ" references in config.py
- .env.example updated with generic examples
  </done>
</task>

<task type="auto">
  <name>Task 3: Convert test_idor.py to template example</name>
  <files>test_idor.py</files>
  <action>
1. Rename file to `example_idor_test.py` (makes it clear this is an example/template)
2. Update module docstring to explain this is a TEMPLATE for IDOR testing:
   ```python
   """
   IDOR Vulnerability Test Template

   This is an EXAMPLE showing how to test for IDOR vulnerabilities.
   Copy and adapt this template for your specific target app and API.

   Usage:
       1. Copy this file to test_<your_app>_idor.py
       2. Update API endpoints for your target
       3. Update authentication flow
       4. Run: python3 test_<your_app>_idor.py
   """
   ```
3. Keep the secure temp file handling (already generalized)
4. Update comments to indicate where app-specific customization is needed:
   - Mark API_BASE usage with `# CUSTOMIZE: Your API base URL`
   - Mark authentication with `# CUSTOMIZE: Your auth flow`
   - Mark IDOR test with `# CUSTOMIZE: Your vulnerable endpoint`
5. Remove the specific SleepIQ business logic comments (blackmail threat, Dennis Hansen)
6. Keep the test structure as a useful template
  </action>
  <verify>
# File should be renamed
ls example_idor_test.py

# Should still import and parse
python3 -c "import ast; ast.parse(open('example_idor_test.py').read())"
  </verify>
  <done>
- File renamed to example_idor_test.py
- Docstring explains template purpose
- CUSTOMIZE markers added at customization points
- SleepIQ-specific business context removed
- Secure temp file handling preserved
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -r "SleepIQ" test_harness.py config.py example_idor_test.py .env.example` returns nothing
- [ ] `grep -r "sleepiq" test_harness.py config.py example_idor_test.py .env.example` returns nothing (case insensitive check)
- [ ] `python3 -c "from test_harness import AndroidTestHarness"` succeeds
- [ ] `TARGET_PACKAGE=com.test.app python3 -c "from config import config; print(config.target_package)"` prints com.test.app
</verification>

<success_criteria>

- Python files contain no SleepIQ-specific references
- AndroidTestHarness accepts package_name parameter
- Config module is optional-credential (doesn't fail on import without auth)
- test_idor.py renamed to example_idor_test.py with template documentation
  </success_criteria>

<output>
After completion, create `.planning/phases/02-generalization/02-01-SUMMARY.md`
</output>
