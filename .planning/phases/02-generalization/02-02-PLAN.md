---
phase: 02-generalization
plan: 02
type: execute
---

<objective>
Generalize shell scripts and update documentation.

Purpose: Remove SleepIQ-specific code from shell scripts, create generic app installation workflow, update all documentation.
Output: Generic shell scripts, updated README, consistent harness naming.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-generalization/02-01-SUMMARY.md

# Key files to modify:
@install-sleepiq.sh
@run-tests.sh
@start-emulator.sh
@README.md

**Tech stack available:** python-dotenv, bash
**Established patterns:**
- Config via environment: TARGET_PACKAGE, TARGET_ID, API_BASE
- Shell scripts check for emulator before proceeding
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create generic install-app.sh (replace install-sleepiq.sh)</name>
  <files>install-app.sh</files>
  <action>
1. Create new `install-app.sh` script (do NOT delete install-sleepiq.sh yet):
   - Accept package name as argument: `./install-app.sh com.example.app`
   - Or read from TARGET_PACKAGE env var if no argument
   - If neither, print usage and exit
2. Script structure:
   ```bash
   #!/bin/bash
   # Install Android App from Google Play Store
   # Usage: ./install-app.sh <package-name>
   #    or: TARGET_PACKAGE=com.example.app ./install-app.sh

   PACKAGE_NAME="${1:-$TARGET_PACKAGE}"
   if [ -z "$PACKAGE_NAME" ]; then
       echo "Usage: ./install-app.sh <package-name>"
       echo "   or: TARGET_PACKAGE=com.example.app ./install-app.sh"
       exit 1
   fi
   ```
3. Copy the logic from install-sleepiq.sh but parameterize PACKAGE_NAME
4. Remove SleepIQ references from all messages
5. After creating and verifying, delete install-sleepiq.sh
  </action>
  <verify>
# Script is executable
chmod +x install-app.sh
./install-app.sh 2>&1 | head -3
# Should show usage message

# Check no SleepIQ references
grep -i sleepiq install-app.sh || echo "No SleepIQ references - good"
  </verify>
  <done>
- install-app.sh created with package parameter
- install-sleepiq.sh deleted
- No SleepIQ references in install-app.sh
  </done>
</task>

<task type="auto">
  <name>Task 2: Update run-tests.sh to use configurable package</name>
  <files>run-tests.sh</files>
  <action>
1. Replace hardcoded PACKAGE_NAME with:
   ```bash
   PACKAGE_NAME="${TARGET_PACKAGE:-}"
   if [ -z "$PACKAGE_NAME" ]; then
       echo "ERROR: TARGET_PACKAGE environment variable not set"
       echo "Usage: TARGET_PACKAGE=com.example.app ./run-tests.sh"
       exit 1
   fi
   ```
2. Update script header comment to remove SleepIQ references
3. Update all user-facing messages to be generic:
   - "SleepIQ app not installed" → "Target app not installed"
   - "SleepIQ Test Harness" → "Android Test Harness"
4. Update help text to reference TARGET_PACKAGE
5. Keep all the shell functions intact (they work with any package)
  </action>
  <verify>
# Without TARGET_PACKAGE, should error
./run-tests.sh 2>&1 | grep -q "TARGET_PACKAGE" && echo "Prompts for TARGET_PACKAGE - good"

# Check no SleepIQ references
grep -i sleepiq run-tests.sh || echo "No SleepIQ references - good"
  </verify>
  <done>
- run-tests.sh reads TARGET_PACKAGE from environment
- Error message shown if TARGET_PACKAGE not set
- No SleepIQ references in run-tests.sh
  </done>
</task>

<task type="auto">
  <name>Task 3: Update start-emulator.sh and documentation</name>
  <files>start-emulator.sh, README.md</files>
  <action>
1. In start-emulator.sh:
   - Rename AVD from "SleepIQ_Test_Device" to "Android_Test_Device"
   - Update comments to remove SleepIQ references
   - Keep the same functionality

2. In README.md:
   - Update title/description to "Android Test Harness"
   - Update usage examples to show generic package names
   - Update quickstart to use TARGET_PACKAGE
   - Remove any SleepIQ-specific testing instructions
   - Add section explaining this is a general-purpose harness

3. Delete SleepIQ-specific documentation if any:
   - Check if RUN_IDOR_TEST.md needs updating or removal
   - If it references SleepIQ specifically, either generalize or remove
  </action>
  <verify>
# Check no SleepIQ references in key files
grep -i sleepiq start-emulator.sh README.md || echo "No SleepIQ references - good"

# AVD name should be generic
grep "Android_Test_Device" start-emulator.sh && echo "AVD name updated - good"
  </verify>
  <done>
- start-emulator.sh uses generic AVD name
- README.md describes generic Android Test Harness
- No SleepIQ references in shell scripts or README
- Phase 2: Generalization complete
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -ri "sleepiq" *.sh README.md` returns nothing (except maybe decompiled/ or apks/)
- [ ] `ls install-sleepiq.sh` fails (file should be deleted)
- [ ] `ls install-app.sh` succeeds
- [ ] `./install-app.sh` without args shows usage message
- [ ] TARGET_PACKAGE is documented in README.md
</verification>

<success_criteria>

- Shell scripts parameterized with TARGET_PACKAGE
- install-sleepiq.sh replaced by install-app.sh
- AVD renamed to Android_Test_Device
- README describes general-purpose harness
- Phase 2 Generalization fully complete
  </success_criteria>

<output>
After completion, create `.planning/phases/02-generalization/02-02-SUMMARY.md`

Mark Phase 2 as complete in ROADMAP.md and STATE.md.
</output>
